<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SawitCatat - Riwayat Panen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sawit-green': '#2E7D32',
                        'sawit-yellow': '#FFD600',
                    }
                },
                fontFamily: {
                    'sans': ['Poppins', 'Inter', 'system-ui', 'sans-serif'],
                }
            }
        }
    </script>
</head>
<body class="bg-white font-sans pb-16">
    <!-- Header -->
    <header class="bg-white shadow-sm p-4 flex items-center justify-center sticky top-0 z-10 md:justify-start md:px-8 lg:px-16">
        <div class="flex items-center">
            <img src="images/logo.png" alt="SawitCatat Logo" class="h-10 mr-2">
            <h1 class="text-sawit-green text-xl font-bold">SawitCatat</h1>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 max-w-md md:max-w-4xl lg:max-w-6xl xl:max-w-7xl">
        <!-- Judul dengan Ikon Kalender -->
        <div class="flex items-center justify-center mb-6 md:justify-start">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-sawit-green mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <h2 class="text-xl font-semibold text-sawit-green md:text-2xl">Riwayat Panen</h2>
        </div>

        <!-- Desktop Stats Overview (Desktop Only) -->
        <div class="hidden md:grid md:grid-cols-4 md:gap-4 mb-6">
            <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-sawit-green">
                <h3 class="text-gray-600 text-sm mb-1">Total Minggu Ini</h3>
                <p class="text-3xl font-bold text-sawit-green"><span id="totalMingguIni">0</span> <span class="text-lg">TBS</span></p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-sawit-yellow">
                <h3 class="text-gray-600 text-sm mb-1">Total Bulan Ini</h3>
                <p class="text-3xl font-bold text-sawit-yellow"><span id="totalBulanIni">0</span> <span class="text-lg">TBS</span></p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-sawit-green">
                <h3 class="text-gray-600 text-sm mb-1">Rata-rata Harian</h3>
                <p class="text-3xl font-bold text-sawit-green"><span id="rataHarian">0</span> <span class="text-lg">TBS</span></p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-sawit-yellow">
                <h3 class="text-gray-600 text-sm mb-1">Lokasi Terbanyak</h3>
                <p class="text-3xl font-bold text-sawit-yellow" id="lokasiTerbanyak">-</p>
            </div>
        </div>

        <!-- Daftar Riwayat Panen -->
        <div id="riwayatContainer" class="md:grid md:grid-cols-3 md:gap-6">
            <!-- Riwayat panen akan diisi oleh JavaScript -->
        </div>

        <!-- Calendar View (Desktop Only) -->
        <div class="hidden md:block bg-white rounded-lg shadow-md p-6 mt-6">
            <h3 class="font-medium text-gray-700 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-sawit-green" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Tampilan Kalender
            </h3>
            <div class="grid grid-cols-7 gap-1 text-center">
                <div class="text-xs font-medium text-gray-500 py-1">Min</div>
                <div class="text-xs font-medium text-gray-500 py-1">Sen</div>
                <div class="text-xs font-medium text-gray-500 py-1">Sel</div>
                <div class="text-xs font-medium text-gray-500 py-1">Rab</div>
                <div class="text-xs font-medium text-gray-500 py-1">Kam</div>
                <div class="text-xs font-medium text-gray-500 py-1">Jum</div>
                <div class="text-xs font-medium text-gray-500 py-1">Sab</div>
                
                <!-- Calendar days (sample only - would be generated based on current month in production) -->
                <div class="p-1 text-center text-gray-400 text-sm">28</div>
                <div class="p-1 text-center text-gray-400 text-sm">29</div>
                <div class="p-1 text-center text-gray-400 text-sm">30</div>
                <div class="p-1 text-center text-gray-400 text-sm">31</div>
                <div class="p-1 text-center text-sm">1</div>
                <div class="p-1 text-center text-sm">2</div>
                <div class="p-1 text-center text-sm">3</div>
                
                <div class="p-1 text-center text-sm">4</div>
                <div class="p-1 text-center text-sm">5</div>
                <div class="p-1 text-center text-sm">6</div>
                <div class="p-1 text-center text-sm">7</div>
                <div class="p-1 text-center text-sm">8</div>
                <div class="p-1 text-center text-sm relative">
                    9
                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 h-1 w-1 bg-sawit-yellow rounded-full"></div>
                </div>
                <div class="p-1 text-center text-sm">10</div>
                
                <div class="p-1 text-center text-sm">11</div>
                <div class="p-1 text-center text-sm relative">
                    12
                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 h-1 w-1 bg-sawit-yellow rounded-full"></div>
                </div>
                <div class="p-1 text-center text-sm relative">
                    13
                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 h-1 w-1 bg-sawit-green rounded-full"></div>
                </div>
                <div class="p-1 text-center text-sm relative">
                    14
                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 h-1 w-1 bg-sawit-green rounded-full"></div>
                </div>
                <div class="p-1 text-center bg-gray-100 rounded-lg font-medium relative">
                    15
                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 h-1 w-1 bg-sawit-green rounded-full"></div>
                </div>
                <div class="p-1 text-center text-sm">16</div>
                <div class="p-1 text-center text-sm">17</div>
            </div>
            
            <div class="flex justify-center mt-4 text-sm text-gray-500">
                <div class="flex items-center mr-4">
                    <div class="h-2 w-2 bg-sawit-green rounded-full mr-1"></div>
                    <span>Panen &gt; 15 TBS</span>
                </div>
                <div class="flex items-center">
                    <div class="h-2 w-2 bg-sawit-yellow rounded-full mr-1"></div>
                    <span>Panen &lt; 15 TBS</span>
                </div>
            </div>
        </div>

        <!-- Load More (Mobile Only) -->
        <button id="loadMoreButton" class="w-full py-3 text-sawit-green font-medium flex items-center justify-center border border-sawit-green rounded-lg hover:bg-green-50 transition duration-200 mt-6 md:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
            Lihat Riwayat Sebelumnya
        </button>
        
        <!-- Load More (Desktop Only) -->
        <div class="hidden md:flex justify-center mt-8">
            <button id="loadMoreDesktopButton" class="bg-white text-sawit-green font-medium py-2 px-6 border border-sawit-green rounded-lg hover:bg-green-50 transition duration-200 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Muat Lebih Banyak
            </button>
        </div>
    </main>

    <!-- Navigation Bar -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200 md:px-8 lg:px-16">
        <div class="flex justify-around max-w-screen-lg mx-auto">
            <a href="index.html" class="flex-1 py-3 flex flex-col items-center justify-center text-gray-500 hover:text-sawit-green">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <span class="text-xs">Beranda</span>
            </a>
            <a href="catat.html" class="flex-1 py-3 flex flex-col items-center justify-center text-gray-500 hover:text-sawit-green">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                <span class="text-xs">Catat</span>
            </a>
            <a href="riwayat.html" class="flex-1 py-3 flex flex-col items-center justify-center text-sawit-green">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="text-xs">Riwayat</span>
            </a>
            <a href="panduan.html" class="flex-1 py-3 flex flex-col items-center justify-center text-gray-500 hover:text-sawit-green">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="text-xs">Info</span>
            </a>
        </div>
    </nav>

    <script>
        // Data model for the app
        const sawitCatatApp = {
            // Current page size and state
            pageSize: 3, // Show 3 days at first
            currentDisplayedDays: 0,
            
            // Initialize the app
            init: function() {
                // Load data from localStorage or initialize if not exists
                this.loadData();
                // Update UI with data
                this.updateUI();
                
                // Set up event listeners
                document.getElementById('loadMoreButton').addEventListener('click', () => {
                    this.loadMoreEntries();
                });
                document.getElementById('loadMoreDesktopButton').addEventListener('click', () => {
                    this.loadMoreEntries();
                });
            },

            // Load data from localStorage
            loadData: function() {
                const storedData = localStorage.getItem('sawitCatatData');
                if (storedData) {
                    this.data = JSON.parse(storedData);
                } else {
                    // Initialize with sample data if empty
                    this.createSampleData();
                }
            },

            // Create sample data for demo purpose
            createSampleData: function() {
                const now = new Date();
                
                // Sample data for demo
                this.data = {
                    entries: [
                        {
                            id: now.getTime(),
                            jumlahTandan: 15,
                            lokasi: 'blok-a',
                            timestamp: new Date(now.getTime() - 2 * 60 * 60 * 1000).toISOString() // 2 hours ago
                        },
                        {
                            id: now.getTime() - 100,
                            jumlahTandan: 9,
                            lokasi: 'blok-c',
                            timestamp: new Date(now.getTime() - 4 * 60 * 60 * 1000).toISOString() // 4 hours ago
                        },
                        {
                            id: now.getTime() - 1000,
                            jumlahTandan: 20,
                            lokasi: 'blok-b',
                            timestamp: new Date(now.getTime() - 24 * 60 * 60 * 1000).toISOString() // 1 day ago
                        },
                        {
                            id: now.getTime() - 2000,
                            jumlahTandan: 7,
                            lokasi: 'blok-a',
                            timestamp: new Date(now.getTime() - 26 * 60 * 60 * 1000).toISOString() // 1 day and 2 hours ago
                        },
                        {
                            id: now.getTime() - 3000,
                            jumlahTandan: 12,
                            lokasi: 'blok-d',
                            timestamp: new Date(now.getTime() - 28 * 60 * 60 * 1000).toISOString() // 1 day and 4 hours ago
                        },
                        {
                            id: now.getTime() - 4000,
                            jumlahTandan: 18,
                            lokasi: 'blok-c',
                            timestamp: new Date(now.getTime() - 48 * 60 * 60 * 1000).toISOString() // 2 days ago
                        },
                        {
                            id: now.getTime() - 5000,
                            jumlahTandan: 11,
                            lokasi: 'blok-b',
                            timestamp: new Date(now.getTime() - 50 * 60 * 60 * 1000).toISOString() // 2 days and 2 hours ago
                        }
                    ]
                };
                
                // Save to localStorage
                localStorage.setItem('sawitCatatData', JSON.stringify(this.data));
            },

            // Group entries by day
            groupEntriesByDay: function() {
                const groupedData = {};
                
                this.data.entries.forEach(entry => {
                    const date = new Date(entry.timestamp);
                    const dateKey = date.toLocaleDateString('id-ID');
                    
                    if (!groupedData[dateKey]) {
                        groupedData[dateKey] = [];
                    }
                    
                    groupedData[dateKey].push(entry);
                });
                
                // Convert to array sorted by date (newest first)
                return Object.entries(groupedData)
                    .map(([date, entries]) => ({
                        date,
                        entries,
                        // Sort entries by time within each day (newest first)
                        sortedEntries: entries.sort((a, b) => 
                            new Date(b.timestamp) - new Date(a.timestamp)
                        )
                    }))
                    .sort((a, b) => {
                        // Sort days by date (newest first)
                        const dateA = new Date(a.entries[0].timestamp);
                        const dateB = new Date(b.entries[0].timestamp);
                        return dateB - dateA;
                    });
            },

            // Get human-readable day label
            getDayLabel: function(dateStr) {
                const today = new Date().toLocaleDateString('id-ID');
                const yesterday = new Date(Date.now() - 86400000).toLocaleDateString('id-ID');
                const twoDaysAgo = new Date(Date.now() - 86400000 * 2).toLocaleDateString('id-ID');
                
                if (dateStr === today) {
                    return 'Hari Ini';
                } else if (dateStr === yesterday) {
                    return 'Kemarin';
                } else if (dateStr === twoDaysAgo) {
                    return '2 Hari Lalu';
                } else {
                    // Format date for other days
                    const date = new Date(dateStr.split('/').reverse().join('-'));
                    return date.toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                }
            },

            // Get human-readable location name
            getLocationName: function(locationCode) {
                const locations = {
                    'blok-a': 'Blok A',
                    'blok-b': 'Blok B',
                    'blok-c': 'Blok C',
                    'blok-d': 'Blok D'
                };
                return locations[locationCode] || locationCode;
            },

            // Format time from timestamp
            formatTime: function(timestamp) {
                const date = new Date(timestamp);
                return date.toLocaleTimeString('id-ID', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },

            // Get entries from the last week
            getWeeklyEntries: function() {
                const now = new Date();
                const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                
                return this.data.entries.filter(entry => 
                    new Date(entry.timestamp) >= oneWeekAgo
                );
            },

            // Get entries from the current month
            getMonthlyEntries: function() {
                const now = new Date();
                const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                
                return this.data.entries.filter(entry => 
                    new Date(entry.timestamp) >= firstDayOfMonth
                );
            },

            // Calculate average daily harvest
            getAverageDailyHarvest: function() {
                const entriesByDay = this.groupEntriesByDay();
                
                if (entriesByDay.length === 0) return 0;
                
                const totalTandans = entriesByDay.reduce((total, day) => {
                    return total + day.entries.reduce((dayTotal, entry) => 
                        dayTotal + entry.jumlahTandan, 0);
                }, 0);
                
                return Math.round(totalTandans / entriesByDay.length);
            },

            // Get most frequent location
            getMostFrequentLocation: function() {
                const locationCounts = {};
                
                this.data.entries.forEach(entry => {
                    locationCounts[entry.lokasi] = (locationCounts[entry.lokasi] || 0) + 1;
                });
                
                // Find location with max count
                let maxCount = 0;
                let mostFrequentLocation = '';
                
                Object.entries(locationCounts).forEach(([location, count]) => {
                    if (count > maxCount) {
                        maxCount = count;
                        mostFrequentLocation = location;
                    }
                });
                
                return this.getLocationName(mostFrequentLocation);
            },

            // Calculate total TBS
            getTotalTBS: function(entries) {
                return entries.reduce((total, entry) => total + entry.jumlahTandan, 0);
            },

            // Update the UI with current data
            updateUI: function() {
                // Update statistics
                const weeklyEntries = this.getWeeklyEntries();
                const monthlyEntries = this.getMonthlyEntries();
                
                document.getElementById('totalMingguIni').textContent = this.getTotalTBS(weeklyEntries);
                document.getElementById('totalBulanIni').textContent = this.getTotalTBS(monthlyEntries);
                document.getElementById('rataHarian').textContent = this.getAverageDailyHarvest();
                document.getElementById('lokasiTerbanyak').textContent = this.getMostFrequentLocation();
                
                // Display entries grouped by day
                this.displayEntries();
            },

            // Display entries in the UI
            displayEntries: function() {
                const container = document.getElementById('riwayatContainer');
                container.innerHTML = ''; // Clear existing content
                
                const entriesByDay = this.groupEntriesByDay();
                
                // Get days to display based on current page size
                const daysToDisplay = entriesByDay.slice(0, this.pageSize);
                this.currentDisplayedDays = daysToDisplay.length;
                
                if (daysToDisplay.length === 0) {
                    container.innerHTML = '<div class="col-span-3 text-center py-8 text-gray-500">Belum ada data panen. Silakan tambahkan data panen baru.</div>';
                    return;
                }
                
                // Display each day's entries
                daysToDisplay.forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'mb-4 md:mb-0';
                    
                    const dayLabel = this.getDayLabel(day.date);
                    
                    let dayHTML = `
                        <div class="text-sm font-medium text-gray-500 mb-2">${dayLabel}</div>
                        <div class="bg-white rounded-lg border border-green-100 overflow-hidden">
                    `;
                    
                    // Add entries for this day
                    day.sortedEntries.forEach((entry, index) => {
                        const isLast = index === day.sortedEntries.length - 1;
                        dayHTML += `
                            <div class="p-4 ${!isLast ? 'border-b border-green-100' : ''} flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="mr-4 text-sawit-green font-semibold">${entry.jumlahTandan} TBS</div>
                                    <div class="text-gray-600 text-sm">${this.getLocationName(entry.lokasi)}</div>
                                </div>
                                <div class="text-gray-400 text-sm">${this.formatTime(entry.timestamp)}</div>
                            </div>
                        `;
                    });
                    
                    dayHTML += `</div>`;
                    dayElement.innerHTML = dayHTML;
                    container.appendChild(dayElement);
                });
                
                // Hide the load more button if we've displayed all days
                if (this.currentDisplayedDays >= entriesByDay.length) {
                    document.getElementById('loadMoreButton').classList.add('hidden');
                    document.getElementById('loadMoreDesktopButton').classList.add('hidden');
                } else {
                    document.getElementById('loadMoreButton').classList.remove('hidden');
                    document.getElementById('loadMoreDesktopButton').classList.remove('hidden');
                }
            },

            // Load more entries
            loadMoreEntries: function() {
                this.pageSize += 3; // Show 3 more days
                this.displayEntries();
            }
        };

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            sawitCatatApp.init();
        });
    </script>
</body>
</html>
